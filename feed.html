<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<title></title>
	<meta name="viewport" content="width=device-width,initial-scale=1">
</head>

<body style="font-family: 'Courier New', monospace;">
	<script type="module">
		const container = document.createElement('div');
		container.style.fontFamily = "'Courier New', monospace";
		container.style.position = "absolute";
		container.style.top = "8px";
		container.style.left = "8px";
		document.body.appendChild(container);

		const refresh = () => {
			const xhttp = new XMLHttpRequest();
			const startTime = performance.now();
			const diffTime = (fixed = 1) => {
				const diff = performance.now() - startTime;
				const res = Math.pow(10, fixed);
				const elapsed = Math.round(diff * res / 1000) / res;
				return elapsed.toFixed(fixed) + "s";
			};

			let timer = window.setInterval(() => {
				container.innerHTML = diffTime();
			}, 1000 / 30);
			const fillContent = (content, append) => {
				if (timer) {
					window.clearInterval(timer);
					timer = 0;
				}
				container.innerHTML = content + append;
			};
			xhttp.onreadystatechange = () => {
				// if (xhttp.readyState == 3) fillContent(xhttp.responseText, '... ' + diffTime());
				if (xhttp.readyState == 4 && xhttp.status == 200) {
					const options = {
						weekday: "long",
						year: "numeric",
						month: "long",
						day: "numeric",
						hour: "numeric",
						minute: "numeric",
						second: "numeric",
					};
					const time = diffTime() + " " + new Date().toLocaleString(undefined, options);
					fillContent(xhttp.responseText, time);

					const minute = 1000 * 60;
					window.setTimeout(() => {
						refresh();
					}, minute * 60);
				}
			};
			let url = "https://snovakow.dev/snovakow/feed.php";
			if (window.location.search === "?dbphistomefel") url += "?dbphistomefel";
			xhttp.open("GET", url, true);
			xhttp.send();
		};
		refresh();
	</script>
</body>

</html>